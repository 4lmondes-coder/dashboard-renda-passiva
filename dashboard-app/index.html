<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Renda Passiva</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

<style>
body {
  font-family:'Segoe UI', sans-serif;
  margin:0;
  background:#0f172a;
  color:white;
}

header {
  background:#111827;
  padding:20px;
  text-align:center;
  font-size:28px;
  font-weight:bold;
}

.container { padding:15px; }

.cards {
  display:flex;
  flex-direction:column;
  gap:15px;
  margin-bottom:20px;
}

.card {
  background:#1e293b;
  padding:20px;
  border-radius:10px;
  text-align:center;
}

.card h3 { margin:10px 0; font-size:18px; color:#94a3b8; }
.card p { font-size:26px; font-weight:bold; }

button {
  padding:14px 20px;
  margin-top:10px;
  background:#22c55e;
  border:none;
  color:white;
  cursor:pointer;
  border-radius:6px;
  font-size:18px;
  width:100%;
  box-sizing:border-box;
}

.progress {
  background:#334155;
  height:22px;
  border-radius:10px;
  margin-top:10px;
}

.progress-bar {
  height:100%;
  background:#22c55e;
  width:0%;
  border-radius:10px;
}

table {
  width:auto;
  max-width:100%;
  border-collapse:collapse;
  margin-top:20px;
  display:block;
  overflow-x:auto;
  word-wrap: break-word;
}

th, td {
  border:1px solid #334155;
  padding:12px;
  text-align:center;
  font-size:18px;
  white-space:nowrap; /* nowrap para auto-largura */
}

th { background:#1e293b; }

input {
  font-size:18px;
  background:#0f172a;
  color:white;
  border:1px solid #334155;
  border-radius:4px;
  padding:6px;
  box-sizing:border-box;
  min-width:50px;
}

canvas {
  background:#1e293b;
  border-radius:10px;
  padding:10px;
  width:100% !important;
  height:auto !important;
}

@media screen and (min-width: 700px) {
  .cards { flex-direction:row; flex-wrap:wrap; }
  .card { flex:1 1 250px; min-width:200px; }
}
</style>
</head>
<body>

<header>ðŸ“Š Dashboard de Renda Passiva</header>

<div class="container">
<div class="cards">
  <div class="card">
    <h3>Total Investido</h3>
    <p id="totalInvestido">R$ 0</p>
  </div>
  <div class="card">
    <h3>Renda Mensal</h3>
    <p id="rendaMensal">R$ 0</p>
  </div>
  <div class="card">
    <h3>Meta Mensal</h3>
    <input type="number" id="meta" placeholder="Digite sua meta" oninput="calcular()">
    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>
</div>

<button onclick="adicionarLinha()">+ Adicionar Ativo</button>

<table id="tabela">
<thead>
<tr>
<th>Ativo</th><th>PreÃ§o</th><th>Qtd</th><th>DY %</th><th>Total</th><th>Renda MÃªs</th>
</tr>
</thead>
<tbody></tbody>
</table>

<h3 style="margin-top:30px;">ðŸ“ˆ EvoluÃ§Ã£o da Renda</h3>
<canvas id="grafico"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let chart;

// Ajusta largura do input conforme conteÃºdo
function ajustarLarguraInput(input){
  const tmp = document.createElement("span");
  tmp.style.visibility = "hidden";
  tmp.style.position = "absolute";
  tmp.style.whiteSpace = "pre";
  tmp.style.font = window.getComputedStyle(input).font;
  tmp.innerText = input.value || input.placeholder || "0";
  document.body.appendChild(tmp);
  input.style.width = (tmp.offsetWidth + 20) + "px"; // espaÃ§o extra
  document.body.removeChild(tmp);
}

// Adiciona uma nova linha
function adicionarLinha(dados=["",0,0,0]){
  let tbody = document.querySelector("#tabela tbody");
  let row = tbody.insertRow();

  // Ativo
  let cellAtivo = row.insertCell();
  cellAtivo.innerHTML = `<input type="text" oninput="ajustarLarguraInput(this); calcular();" value="${dados[0]}" placeholder="Ativo">`;
  ajustarLarguraInput(cellAtivo.children[0]);

  // PreÃ§o, Qtd, DY %
  for(let i=1;i<4;i++){
    let cell = row.insertCell();
    cell.innerHTML = `<input type="number" oninput="ajustarLarguraInput(this); calcular();" value="${dados[i]}" placeholder="0">`;
    ajustarLarguraInput(cell.children[0]);
  }

  // Total e Renda MÃªs (calculados)
  row.insertCell().innerText = "0";
  row.insertCell().innerText = "0";
}

// Calcula totais, renda e grÃ¡ficos
function calcular(){
  let rows = document.querySelectorAll("#tabela tbody tr");
  let totalInvestido = 0, rendaTotal = 0, dadosGrafico = [], labels = [];

  rows.forEach((row,index)=>{
    let preco = parseFloat(row.cells[1].children[0].value)||0;
    let qtd = parseFloat(row.cells[2].children[0].value)||0;
    let dy = parseFloat(row.cells[3].children[0].value)||0;
    let total = preco*qtd;
    let renda = (total*(dy/100))/12;
    row.cells[4].innerText = total.toFixed(2);
    row.cells[5].innerText = renda.toFixed(2);
    totalInvestido += total;
    rendaTotal += renda;
    dadosGrafico.push(renda.toFixed(2));
    labels.push("Ativo "+(index+1));
  });

  document.getElementById("totalInvestido").innerText = "R$ "+totalInvestido.toFixed(2);
  document.getElementById("rendaMensal").innerText = "R$ "+rendaTotal.toFixed(2);

  let meta = parseFloat(document.getElementById("meta").value)||0;
  let progresso = meta ? (rendaTotal/meta)*100 : 0;
  if(progresso>100) progresso = 100;
  document.getElementById("progressBar").style.width = progresso+"%";

  salvarDados();
  atualizarGrafico(labels,dadosGrafico);
}

function atualizarGrafico(labels,dados){
  if(chart) chart.destroy();
  let ctx = document.getElementById("grafico");
  chart = new Chart(ctx,{
    type:"bar",
    data:{labels:labels,datasets:[{label:"Renda Mensal por Ativo", data:dados, backgroundColor:"#22c55e"}]}
  });
}

function salvarDados(){
  let dados = [];
  document.querySelectorAll("#tabela tbody tr").forEach(row=>{
    dados.push([
      row.cells[0].children[0].value,
      row.cells[1].children[0].value,
      row.cells[2].children[0].value,
      row.cells[3].children[0].value
    ]);
  });
  localStorage.setItem("ativos",JSON.stringify(dados));
  localStorage.setItem("meta", document.getElementById("meta").value);
}

function carregarDados(){
  let ativos = JSON.parse(localStorage.getItem("ativos")||"[]");
  let meta = localStorage.getItem("meta");
  if(meta) document.getElementById("meta").value = meta;
  ativos.forEach(a => adicionarLinha(a));
  calcular();
}

carregarDados();
</script>

</body>
</html>
